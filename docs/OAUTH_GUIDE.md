# OAuth 配置指南（飞书）

本指南用于帮助你在网页端配置飞书 OAuth 参数，并解释每个字段的来源与用途。

## 1. 先决条件
- 你有飞书账号，且能进入飞书开放平台控制台（企业管理员或应用创建者权限）。
- 本项目已启动后端与前端服务。
- 本地允许写入 `data/config.json`（网页配置向导会写入该文件）。

## 2. 创建应用（官方流程）
### 2.1 创建“企业自建应用”
1) 进入飞书开放平台控制台。
2) 选择创建应用并选择“企业自建应用”。
3) 填写应用名称与描述并完成创建。

### 2.2 获取 App ID / App Secret
1) 打开应用详情页。
2) 在“应用凭证”页面复制 App ID 与 App Secret。

### 2.3 配置 OAuth 回调地址
1) 打开“安全设置 / OAuth 回调”。
2) 添加回调地址（必须与网页配置向导中的回调地址完全一致）：
   - 开发环境：`http://localhost:8000/auth/callback`
   - 生产环境：`http://localhost:8080/api/auth/callback`
3) 保存设置。

### 2.4 配置权限 Scopes
1) 打开“权限管理”。
2) 按需添加权限，建议遵循最小权限原则。
3) 如平台需要审核，等待审核通过后再授权。

> 提示：如果应用未发布或未对测试用户开放，授权可能失败；请完成应用可用性设置。

## 3. 网页配置向导字段说明（逐项对照）
| 字段                         | 用途                      | 来源与说明                                                                                        |
| -------------------------- | ----------------------- | -------------------------------------------------------------------------------------------- |
| 授权地址（Authorize URL）        | 打开用户登录与授权页面             | 来自官方 OAuth2 授权码文档。常见为 `https://open.feishu.cn/open-apis/authen/v1/index`（以官方文档为准）。           |
| Token 地址（Access Token URL） | 授权码换取 user_access_token | 来自官方 OAuth2 Token 文档。常见为 `https://open.feishu.cn/open-apis/authen/v1/access_token`（以官方文档为准）。 |
| App ID                     | 应用唯一标识                  | “应用凭证”页面获取。                                                                                  |
| App Secret                 | 应用密钥                    | “应用凭证”页面获取（敏感信息）。                                                                            |
| 回调地址（Redirect URI）         | 授权完成后的回跳地址              | 必须与控制台配置完全一致（含协议与端口）。                                                                        |
| Scopes                     | 申请的权限范围（逗号分隔）           | 在“权限管理”中添加并通过审核后使用。                                                                          |

### 建议 Scopes（按需取用）
以下为本项目常见的最小权限组合，请以你实际业务和官方权限说明为准：
- `drive:drive`
- `docs:doc`
- `drive:drive.metadata:readonly`
- `contact:contact.base:readonly`

## 4. 保存与验证
1) 在网页端填写配置并点击“保存配置”。
2) 点击“登录飞书”完成授权。
3) 如失败，请逐项排查：
   - 回调地址是否与控制台完全一致（含协议与端口）。
   - App ID / App Secret 是否正确。
   - Scopes 是否已添加并通过审核（如需要）。
   - 授权地址与 Token 地址是否与官方文档一致。

### 常见报错：Access denied / 缺少权限
若出现“获取根目录失败: Access denied”或提示缺少权限（如 `drive:drive`、`drive:drive.metadata:readonly`），请确认：
1) 飞书控制台“权限管理”中已添加上述权限，且是**用户身份权限**。
2) 保存权限配置后，必须**重新授权**（退出登录后再次点击“登录飞书”）。

## 5. 官方文档链接（务必以官方为准）
> 由于飞书官方文档为动态页面，请以飞书开放平台文档中的最新说明为准：
- 飞书开放平台首页：`https://open.feishu.cn/document/home/index`
- OAuth2 授权码获取文档（获取授权码）
- OAuth2 Token 文档（获取用户 Access Token）
- OAuth 回调地址配置文档
- 权限管理（Scopes）文档

（请在飞书开放平台文档中搜索上述关键词进入对应页面。）

## 6. 安全提示
- App Secret 为敏感信息，保存后会写入本地 `data/config.json`，请勿提交到公开仓库。
- 若不希望落盘，可改用环境变量并清空配置文件中的 Secret。

本指南将随飞书官方文档更新而同步维护。
