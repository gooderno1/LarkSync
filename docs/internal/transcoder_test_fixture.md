# Docx 转码内部测试文档模板

用于在飞书端构造一份“全类型”文档，做人工回归。目标是一次覆盖，不再按线上问题逐个补丁。

## 使用方式

1. 在飞书新建文档，按下方章节依次填充内容。
2. 触发下载同步，检查本地 `.md` 输出。
3. 与“预期结果”对照；若不一致，先补单测再改代码。

## 模板内容与预期

### 1. 标题与文本样式

- 输入：`H1/H2/H3`、粗体、斜体、删除线、下划线、行内代码、普通链接
- 预期：标准 Markdown 标题与行内样式，链接渲染为 `[text](url)`

### 2. 列表与待办

- 输入：无序列表、有序列表、嵌套列表、待办完成/未完成、列表内换行
- 预期：缩进层级正确；待办为 `- [x]`/`- [ ]`

### 3. 引用与代码块

- 输入：引用块、Callout、代码块（带语言）
- 预期：引用前缀 `>`；代码块为三反引号并带语言标识

### 4. 表格与复杂单元格

- 输入：普通表格、单元格内多段文本、换行、列表
- 预期：Markdown 表格输出；单元格换行转换为 `<br>`

### 5. 内嵌 Sheet（关键）

- 输入：
- 含文本富段落（segmentStyle）
- 含 mention 链接
- 含 `formattedValue`、`formula`、数字、布尔、嵌套对象
- 预期：
- 优先输出 Markdown 表格
- 链接输出 `[text](url)`
- 富文本内容不中断，换行转 `<br>`
- 如果接口异常，降级为 `sheet_token` 占位

### 6. 图片与附件

- 输入：图片、附件文件
- 预期：
- 图片下载到 `assets/`，文中是相对路径
- 附件下载到 `attachments/`，文中是相对链接

### 7. 插件块与特殊元素

- 输入：Mermaid add-ons、mention user、mention doc、reminder、equation
- 预期：
- Mermaid 渲染为 ```mermaid 代码块
- 其余元素可读，不丢内容

### 8. 兼容回刷

- 输入：历史本地文件保留 `sheet_token` 占位
- 预期：即使云端 `mtime` 未变化，也会触发一次重下重转，替换旧占位

## 对应自动化回归

- `apps/backend/tests/test_transcoder.py`
- `apps/backend/tests/test_sync_runner.py`
